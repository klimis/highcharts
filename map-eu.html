<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>

<div id="container"></div>
<script>
  (async () => {
    const topology = await fetch(
      "https://code.highcharts.com/mapdata/custom/world.topo.json"
    ).then((response) => response.json());

    // Prepare demo data. The data is joined to map using value of 'hc-key'
    // property by default. See API docs for 'joinBy' for more info on linking
    // data and map.
    // All EU27 countries with the same value
    const eu27Value = 8;
    const data = [
      { id: "dk", value: eu27Value },
      { id: "de", value: eu27Value },
      { id: "fr", value: eu27Value },
      { id: "ie", value: eu27Value },
      { id: "hr", value: eu27Value },
      { id: "ee", value: eu27Value },
      { id: "cy", value: eu27Value },
      { id: "fi", value: eu27Value },
      { id: "gr", value: eu27Value },
      { id: "se", value: eu27Value },
      { id: "nl", value: eu27Value },
      { id: "es", value: eu27Value },
      { id: "lt", value: eu27Value },
      { id: "it", value: eu27Value },
      { id: "mt", value: eu27Value },
      { id: "nc", value: eu27Value },
      { id: "pl", value: eu27Value },
      { id: "sk", value: eu27Value },
      { id: "hu", value: eu27Value },
      { id: "lu", value: eu27Value },
      { id: "si", value: eu27Value },
      { id: "be", value: eu27Value },
      { id: "cnm", value: eu27Value },
      { id: "bg", value: eu27Value },
      { id: "ro", value: eu27Value },
      { id: "lv", value: eu27Value },
      { id: "at", value: eu27Value },
      { id: "cz", value: eu27Value },
      { id: "pt", value: eu27Value },
      // Additional countries
      { id: "jp", value: 3 }, // Japan
      { id: "cn", value: 6 }, // China
      { id: "us", value: 7 }, // USA
    ];

    // List of all EU27 country IDs for easy reference
    const eu27Countries = [
      "dk",
      "de",
      "fr",
      "ie",
      "hr",
      "ee",
      "cy",
      "fi",
      "gr",
      "se",
      "nl",
      "es",
      "lt",
      "it",
      "mt",
      "nc",
      "pl",
      "sk",
      "hu",
      "lu",
      "si",
      "be",
      "cnm",
      "bg",
      "ro",
      "lv",
      "at",
      "cz",
      "pt",
    ];

    // Create the chart
    Highcharts.mapChart("container", {
      chart: {
        map: topology,
      },

      title: {
        text: "World Map - EU27, USA, China, and Japan",
      },

      subtitle: {
        text: 'Source map: <a href="https://code.highcharts.com/mapdata/custom/world.topo.json">World</a>',
      },

      mapNavigation: {
        enabled: true,
        buttonOptions: {
          verticalAlign: "bottom",
        },
      },
      mapView: {
        // projection,

        projection: {
          name: "WebMercator",
        },
        zoom: 2,
        center: [6.5, 61],
      },

      colorAxis: {
        min: 0,
      },

      tooltip: {
        formatter: function () {
          // Check if it's an EU27 country
          if (eu27Countries.includes(this.point.id)) {
            return "<b>EU27</b><br/>Value: <b>8</b>";
          } else if (this.point.id === "jp") {
            return "<b>Japan</b><br/>Value: <b>3</b>";
          } else if (this.point.id === "cn") {
            return "<b>China</b><br/>Value: <b>6</b>";
          } else if (this.point.id === "us") {
            return "<b>USA</b><br/>Value: <b>7</b>";
          } else {
            // Fallback for any other countries
            return (
              "<b>" +
              this.point.name +
              "</b><br/>Value: <b>" +
              this.point.value +
              "</b>"
            );
          }
        },
      },

      series: [
        {
          // Base layer - all countries without labels
          mapData: topology,
          allAreas: true,
          nullColor: "#f0f0f0",
          borderColor: "#ffffff",
          borderWidth: 0.5,
          name: "All Countries",
          enableMouseTracking: false,
          dataLabels: {
            enabled: false,
          },
        },
        {
          // Data layer - only countries with data and labels
          data: data,
          mapData: topology,
          joinBy: ["hc-key", "id"],
          allAreas: false,
          name: "Countries with data",
          states: {
            hover: {
              color: "#BADA55",
            },
          },
          dataLabels: {
            enabled: true,
            format: "{point.name}",
          },
          point: {
            events: {
              mouseOver: function () {
                // Only highlight all EU27 countries when hovering over EU countries
                if (eu27Countries.includes(this.id)) {
                  const chart = this.series.chart;
                  eu27Countries.forEach((countryId) => {
                    const point = chart.get(countryId);
                    if (point) point.setState("hover");
                  });
                }
                // For non-EU countries (Japan, China, USA), just highlight themselves
              },
              mouseOut: function () {
                // Reset hover state for all EU27 countries if this was an EU country
                if (eu27Countries.includes(this.id)) {
                  const chart = this.series.chart;
                  eu27Countries.forEach((countryId) => {
                    const point = chart.get(countryId);
                    if (point) point.setState("");
                  });
                }
                // For non-EU countries, the default behavior will handle the reset
              },
            },
          },
        },
      ],
    });
  })();
</script>
<style>
  #container {
    height: 700px;
    min-width: 310px;
    max-width: 800px;
    margin: 0 auto;
  }

  .loading {
    margin-top: 10em;
    text-align: center;
    color: gray;
  }
</style>
